{"_path":"/hardware","_dir":"","_draft":false,"_partial":false,"_locale":"","_empty":false,"title":"üïπÔ∏è Hardware","description":"There is no dedicated hardware to use with dieKlingel softeare. However we already build one or another doorbell, so there are some hardware components which we used for the builds. The reason why we decided to publish the list of hardware is not to restrict the harware, where the software is runnig on. We wanted to have a place to take a look when you have no idea which hardware to buy and use. But thats not the only reason (no üß¢), over the last few years we stumbled over the same hardware issues over and over again, which, as you can imagne, is not as funny as it sounds. Most of the time it is more a software/configuration issue than a actual hardware issue, so you'll find a list of components and some hints, how we configured the parts, and told them to behave like we wan't.","body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"Ô∏è-hardware"},"children":[{"type":"text","value":"üïπÔ∏è Hardware"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"There is no dedicated hardware to use with dieKlingel softeare. However we already build one or another doorbell, so there are some hardware components which we used for the builds. The reason why we decided to publish the list of hardware is not to restrict the harware, where the software is runnig on. We wanted to have a place to take a look when you have no idea which hardware to buy and use. But thats not the only reason (no üß¢), over the last few years we stumbled over the same hardware issues over and over again, which, as you can imagne, is not as funny as it sounds. Most of the time it is more a software/configuration issue than a actual hardware issue, so you'll find a list of components and some hints, how we configured the parts, and told them to behave like we wan't."}]},{"type":"element","tag":"h2","props":{"id":"the-main-controller"},"children":[{"type":"text","value":"üìü The main controller"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://www.reichelt.de/DE/DE/raspberry-pi-4-b-4x-1-5-ghz-2-gb-ram-wlan-bt-rasp-pi-4-b-2gb-p259919.html?r=1&src=raspberrypi","rel":["nofollow"]},"children":[{"type":"text","value":"Rasberry Pi 4 - 2 GB"}]}]}]},{"type":"element","tag":"h2","props":{"id":"the-audio-interface-speaker-and-microphone"},"children":[{"type":"text","value":"The audio interface (speaker and microphone)"}]},{"type":"element","tag":"h3","props":{"id":"speaker"},"children":[{"type":"text","value":"üîà Speaker"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://www.reichelt.de/raspberry-pi-shield-hi-fi-stereo-sound-hat-wm8960-rpi-shd-stereo-p266063.html","rel":["nofollow"]},"children":[{"type":"text","value":"WM8960 Audio HAT"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://www.waveshare.com/wiki/WM8960_Audio_HAT","rel":["nofollow"]},"children":[{"type":"text","value":"https://www.waveshare.com/wiki/WM8960_Audio_HAT"}]}]}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"In the meantime the driver is builtin into the Raspberry Pi firmware (see: "},{"type":"element","tag":"a","props":{"href":"https://github.com/raspberrypi/linux/pull/4039","rel":["nofollow"]},"children":[{"type":"text","value":"#4093"}]},{"type":"text","value":") but you have to enable it. To enable the driver you have to add the overlay to "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"/boot/config.txt"}]},{"type":"element","tag":"code","props":{"className":["language-ini"],"code":"# Enable the wm8960-soundcard\ndtoverlay=wm8960-soundcard\n","language":"ini","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-326375"},"children":[{"type":"text","value":"# Enable the wm8960-soundcard\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-748473"},"children":[{"type":"text","value":"dtoverlay"}]},{"type":"element","tag":"span","props":{"class":"ct-996399"},"children":[{"type":"text","value":"=wm8960-soundcard"}]}]}]}]}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"You should see the soundcard when running "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"aplay -l"}]},{"type":"text","value":":"},{"type":"element","tag":"code","props":{"className":["language-sh"],"code":"card 4: wm8960soundcard [wm8960-soundcard], device 0: bcm2835-i2s-wm8960-hifi wm8960-hifi-0 [bcm2835-i2s-wm8960-hifi wm8960-hifi-0]\n  Subdevices: 1/1\n  Subdevice #0: subdevice #0\n","language":"sh","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-970031"},"children":[{"type":"text","value":"card"}]},{"type":"element","tag":"span","props":{"class":"ct-996399"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-531245"},"children":[{"type":"text","value":"4"}]},{"type":"element","tag":"span","props":{"class":"ct-724922"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"class":"ct-996399"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-724922"},"children":[{"type":"text","value":"wm8960soundcard"}]},{"type":"element","tag":"span","props":{"class":"ct-996399"},"children":[{"type":"text","value":" [wm8960-soundcard], device 0: bcm2835-i2s-wm8960-hifi wm8960-hifi-0 [bcm2835-i2s-wm8960-hifi wm8960-hifi-0]\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-996399"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-970031"},"children":[{"type":"text","value":"Subdevices:"}]},{"type":"element","tag":"span","props":{"class":"ct-996399"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-531245"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-724922"},"children":[{"type":"text","value":"/1\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-996399"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-970031"},"children":[{"type":"text","value":"Subdevice"}]},{"type":"element","tag":"span","props":{"class":"ct-996399"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-326375"},"children":[{"type":"text","value":"#0: subdevice #0"}]}]}]}]}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If the soundcard is not detected, after a reboot, try unplugging the Raspberry Pi from the powersupply and plug in again. When the soundcard is detected but you can't hear anything, you should check that the output isn't muted or the volume is at 0%. Run "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"alsamixe"}]},{"type":"text","value":" and check the properties for:"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Speaker"}]},{"type":"text","value":": The master volume"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Playback"}]},{"type":"text","value":": The Volume of the Soundcard"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Left Output Mixer PCM"}]},{"type":"text","value":": To enable the left channel"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Right Output Mixer PCM"}]},{"type":"text","value":": To enable the right channel"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://www.berrybase.de/externer-usb-mini-lautsprecher-schwarz","rel":["nofollow"]},"children":[{"type":"text","value":"External USB Mini Speaker"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The USB speaker should work out of the box, however it has a continous quiet hissing, which is nearly impossible to hear, if your ear isn't directly in front of the speaker."}]}]},{"type":"element","tag":"h3","props":{"id":"Ô∏è-microphone"},"children":[{"type":"text","value":"üéôÔ∏è Microphone"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://www.berrybase.de/adafruit-mini-usb-mikrofon","rel":["nofollow"]},"children":[{"type":"text","value":"Mini USB Microphone (adafruit)"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://www.berrybase.de/usb-mini-mikrofon","rel":["nofollow"]},"children":[{"type":"text","value":"Mini USB Microphone"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Both of the obove microphones look exactly the same, the came in an equal package. But one is from adafruit the other isn't and we can't even belive it, the more expensive microphone had a better sound. But we recommend try it yourself."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"We stumbled across echo over and over again. So we remcommend to use the echo cancallation module from pipewire, it does a pretty good job. Youn can find information about the module here <>. You can enable it by default, when creating a file "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"/etc/pipewire/pipewire.conf.d/echo-cancel.conf"}]},{"type":"text","value":":"},{"type":"element","tag":"code","props":{"className":["language-conf"],"code":"context.modules = [\n  {\n    name = libpipewire-module-echo-cancel\n    args = { }\n  }\n]\n","language":"conf","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"context.modules = [\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"  {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"    name = libpipewire-module-echo-cancel\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"    args = { }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"]"}]}]}]}]}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"And don't forget to set the echo cancel source and sink as default for liblinphone in the "},{"type":"element","tag":"a","props":{"href":"https://github.com/KoiFresh/dieklingel-core/blob/main/service/app/core.ini.in","rel":["nofollow"]},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"core.ini"}]}]},{"type":"text","value":":"},{"type":"element","tag":"code","props":{"className":["language-√¨ni"],"code":"[core.sip]\nplayback-device=PulseAudio Unknown: Echo-Cancel Sink\ncapture-device=PulseAudio Unknown: Echo-Cancel Source\n","language":"√¨ni","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"[core.sip]\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"playback-device=PulseAudio Unknown: Echo-Cancel Sink\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"capture-device=PulseAudio Unknown: Echo-Cancel Source"}]}]}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"Ô∏è-the-display"},"children":[{"type":"text","value":"üñ•Ô∏è The display"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://www.amazon.de/Touchscreen-kapazitiver-1024x600-Display-Raspberry/dp/B07YJDSCKR","rel":["nofollow"]},"children":[{"type":"text","value":"7inch HDMI Touchscreen 1024x600"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"http://www.lcdwiki.com/7inch_HDMI_Display-C","rel":["nofollow"]},"children":[{"type":"text","value":"http://www.lcdwiki.com/7inch_HDMI_Display-C"}]}]}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"You do not have to install the driver as described on lcdwiki.com. The display should work out of the box. We just have to rotate it by 90 degrees to put it into portrait mode. To rotate the display you could use the graphical tool "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"ARandR"}]},{"type":"text","value":" which is preinstalled on Raspberry Pi Desktop or you can modify the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"$HOME/.config/wayfire.ini"}]},{"type":"element","tag":"code","props":{"className":["language-ini"],"code":"[output:HDMI-A-1]\nmode = 1024x600@59821\nposition = 0,0\ntransform = 90\n\n[input-device:wch.cn USB2IIC_CTP_CONTROL]\noutput = HDMI-A-1\n","language":"ini","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-970031"},"children":[{"type":"text","value":"[output:HDMI-A-1]\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-748473"},"children":[{"type":"text","value":"mode"}]},{"type":"element","tag":"span","props":{"class":"ct-996399"},"children":[{"type":"text","value":" = 1024x600@59821\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-748473"},"children":[{"type":"text","value":"position"}]},{"type":"element","tag":"span","props":{"class":"ct-996399"},"children":[{"type":"text","value":" = 0,0\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-748473"},"children":[{"type":"text","value":"transform"}]},{"type":"element","tag":"span","props":{"class":"ct-996399"},"children":[{"type":"text","value":" = 90\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-970031"},"children":[{"type":"text","value":"[input-device:wch.cn USB2IIC_CTP_CONTROL]\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-748473"},"children":[{"type":"text","value":"output"}]},{"type":"element","tag":"span","props":{"class":"ct-996399"},"children":[{"type":"text","value":" = HDMI-A-1"}]}]}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You can get the name of the input device (touchscreen) by running "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"libinput list-devices"}]},{"type":"text","value":". However the output rotation is applied as soon as the file is saved, but you have to reboot, to also apply the touchscreen rotation. For more information about the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"wayfire.ini"}]},{"type":"text","value":" configuration refer to "},{"type":"element","tag":"a","props":{"href":"https://github.com/WayfireWM/wayfire/wiki/Configuration","rel":["nofollow"]},"children":[{"type":"text","value":"https://github.com/WayfireWM/wayfire/wiki/Configuration"}]},{"type":"text","value":"."}]},{"type":"element","tag":"h2","props":{"id":"the-movement-detection"},"children":[{"type":"text","value":"üì° The movement detection"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://www.amazon.de/gp/product/B06XHDGXKL","rel":["nofollow"]},"children":[{"type":"text","value":"Microwave Radarsensor"}]}]}]},{"type":"element","tag":"h2","props":{"id":"the-camera"},"children":[{"type":"text","value":"üì∑ The camera"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://www.amazon.de/gp/product/B074W6TPHF","rel":["nofollow"]},"children":[{"type":"text","value":"Raspberry Pi Camera (OV5647, 160¬∞ Fisheye)"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The camera is enabled by default, but since Raspberry Pi switched to libcamera instead of V4L2 it is no longer working with the "},{"type":"element","tag":"a","props":{"href":"https://gitlab.linphone.org/BC/public/mediastreamer2","rel":["nofollow"]},"children":[{"type":"text","value":"mediastreamer2"}]},{"type":"text","value":" used by "},{"type":"element","tag":"a","props":{"href":"https://gitlab.linphone.org/BC/public/liblinphone","rel":["nofollow"]},"children":[{"type":"text","value":"liblinphone"}]},{"type":"text","value":". To bring back the functionality as it was with V4L2 you should use the libcamera-v4l2 module when running the core, as it is used when running the core as service compiled with "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"RASPBERRYPI_LIBCAMERA_SUPPORT=ON"}]},{"type":"text","value":"."},{"type":"element","tag":"code","props":{"className":["language-sh"],"code":"sudo apt-get instal libcamera-v4l2\nLD_PRELOAD=/usr/lib/aarch64-linux-gnu/libcamera/v4l2-compat.so dieklingel-core\n","language":"sh","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-970031"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-996399"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-724922"},"children":[{"type":"text","value":"apt-get"}]},{"type":"element","tag":"span","props":{"class":"ct-996399"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-724922"},"children":[{"type":"text","value":"instal"}]},{"type":"element","tag":"span","props":{"class":"ct-996399"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-724922"},"children":[{"type":"text","value":"libcamera-v4l2\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-996399"},"children":[{"type":"text","value":"LD_PRELOAD"}]},{"type":"element","tag":"span","props":{"class":"ct-748473"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-724922"},"children":[{"type":"text","value":"/usr/lib/aarch64-linux-gnu/libcamera/v4l2-compat.so"}]},{"type":"element","tag":"span","props":{"class":"ct-996399"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-970031"},"children":[{"type":"text","value":"dieklingel-core"}]}]}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"PS: None of the links above are affilate links or in any relationship with us. We don't get a single cent, if you buy something from the parts above. We recommend to check out other sellers for cheaper prices or better delivery conditions."}]}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-326375{color:#6A737D;}\n.ct-748473{color:#D73A49;}\n.ct-996399{color:#24292E;}\n.ct-970031{color:#6F42C1;}\n.ct-531245{color:#005CC5;}\n.ct-724922{color:#032F62;}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"the-main-controller","depth":2,"text":"üìü The main controller"},{"id":"the-audio-interface-speaker-and-microphone","depth":2,"text":"The audio interface (speaker and microphone)","children":[{"id":"speaker","depth":3,"text":"üîà Speaker"},{"id":"Ô∏è-microphone","depth":3,"text":"üéôÔ∏è Microphone"}]},{"id":"Ô∏è-the-display","depth":2,"text":"üñ•Ô∏è The display"},{"id":"the-movement-detection","depth":2,"text":"üì° The movement detection"},{"id":"the-camera","depth":2,"text":"üì∑ The camera"}]}},"_type":"markdown","_id":"content:hardware.md","_source":"content","_file":"hardware.md","_extension":"md"}