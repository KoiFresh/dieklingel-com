<!DOCTYPE html>
<html >
<head><meta charset="utf-8">
<title>FHEM als Türöffner</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta property="og:title" content="FHEM als Türöffner">
<meta name="description" content="Der Core der Klingel bietet im wesentlichen eine Schnittstelle via MQTT an, über diese verschiedene Events abgerufen oder ausgelöst werden können. Eine integration für weitere Schnittstellen gibt es nicht (bis auf einen mqtt-http-proxy). Das stellt uns jedoch kaum vor ein Problem, da es genügend Systeme mit MQTT integration gibt, die problemlos weitere Aufgaben für uns übernehmen können. So werden wir im folgenden FHEM so konfigurieren, dass ein Pin des Raspberry Pi's beim eingeben von 123456789 als Passcode auf der Kiosk Anwendung des dieKlingel Software Packetes für drei Sekunden auf HIGH und danach wieder auf LOW geschaltet wird.">
<meta property="og:description" content="Der Core der Klingel bietet im wesentlichen eine Schnittstelle via MQTT an, über diese verschiedene Events abgerufen oder ausgelöst werden können. Eine integration für weitere Schnittstellen gibt es nicht (bis auf einen mqtt-http-proxy). Das stellt uns jedoch kaum vor ein Problem, da es genügend Systeme mit MQTT integration gibt, die problemlos weitere Aufgaben für uns übernehmen können. So werden wir im folgenden FHEM so konfigurieren, dass ein Pin des Raspberry Pi's beim eingeben von 123456789 als Passcode auf der Kiosk Anwendung des dieKlingel Software Packetes für drei Sekunden auf HIGH und danach wieder auf LOW geschaltet wird."><link rel="preload" as="fetch" crossorigin="anonymous" href="/blog/fhem-als-tueroeffner/_payload.json"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/entry.798ec375.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/blog.df077181.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/_...slug_.427b3dc2.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ContentDoc.6d7bb9e6.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ContentRenderer.30a72c1d.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ContentRendererMarkdown.e58b7552.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/index.a6ef77ff.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/preview.d8761026.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ContentQuery.1d611de9.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/query.1cb7d39b.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/utils.34ea6907.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseH1.96f00ce1.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseP.a7a31c9f.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseCodeInline.f625aed6.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseA.d9d9a744.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/nuxt-link.94d39784.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseCode.bdd298bb.js"><link rel="prefetch" as="script" crossorigin href="/_nuxt/default.1b2d036e.js"><link rel="prefetch" as="script" crossorigin href="/_nuxt/error-404.090fb7bf.js"><link rel="prefetch" as="script" crossorigin href="/_nuxt/error-500.65aa97fb.js"><style>.blog[data-v-ba1350bf]{padding:1em}</style><style>pre code .line{display:block;min-height:1rem}</style></head>
<body ><div id="__nuxt"><div><div class="blog" data-v-ba1350bf><div><!--[--><div><h1 id="fhem-als-türöffner"><!--[-->FHEM als Türöffner<!--]--></h1><p><!--[-->Der Core der Klingel bietet im wesentlichen eine Schnittstelle via MQTT an, über diese verschiedene Events abgerufen oder ausgelöst werden können. Eine integration für weitere Schnittstellen gibt es nicht (bis auf einen mqtt-http-proxy). Das stellt uns jedoch kaum vor ein Problem, da es genügend Systeme mit MQTT integration gibt, die problemlos weitere Aufgaben für uns übernehmen können. So werden wir im folgenden FHEM so konfigurieren, dass ein Pin des Raspberry Pi&#39;s beim eingeben von <code><!--[-->123456789<!--]--></code> als Passcode auf der Kiosk Anwendung des dieKlingel Software Packetes für drei Sekunden auf HIGH und danach wieder auf LOW geschaltet wird.<!--]--></p><p><!--[-->Zu allererst werden wir in FHEM ein neues Gerät anlegen, welches den GPIO Pin 17 (<a href="https://pinout.xyz/pinout/pin11_gpio17/" rel="nofollow"><!--[-->Pin 11<!--]--></a>) am Rasperry Pi für drei Sekunden auf HIGH und danach wieder auf LOW schaltet.<!--]--></p><!--[--><pre><code>sudo addgroup fhem gpio
</code></pre><!--]--><p><!--[-->In der Fhem Befehlszeile:<!--]--></p><!--[--><pre><code>define frontdoor RPI_GPIO 17
attr frontdoor direction output
</code></pre><!--]--><p><!--[-->So da wir nun den Pin als Gerät angelegt habe, können wir den Pin für drei Sekunden auf HIGH schalten<!--]--></p><!--[--><pre><code>set frontdoor on-for-timer 3
</code></pre><!--]--><p><!--[-->Jetzt legen wir uns in der Konfiguration des Cores noch eine Lane an, welche per <a href="https://wiki.fhem.de/wiki/CsrfToken-HowTo" rel="nofollow"><!--[-->HTTP den FHEM befehl<!--]--></a> ausführt und den Passcode überprüft. Um den FHEM Befehl auszuführen nehmen wir uns ein kurzes Python Script zu Hilfe<!--]--></p><!--[--><pre><code>import os, json, requests, sys

url = sys.argv[1]

response = requests.request(&quot;GET&quot;, url)
token = response.headers[&quot;X-FHEM-csrfToken&quot;]
requests.request(&quot;GET&quot;, url + &quot;&amp;XHR=1&amp;fwcsrf=&quot; + token)
</code></pre><!--]--><p><!--[-->Dieses legen wir im Ordner <code><!--[-->scripts<!--]--></code> im <code><!--[-->$DIEKLINGEL_HOME<!--]--></code> Verzeichnis ab. Wenn die Anwendung als Snap läuft befindet sich das Home Verzeichnis unter <code><!--[-->/var/snap/dieklingel-core/current<!--]--></code>. Jetzt könne wir eine Lane erstellen, welches den Passcode überprüft und bei korrektem Passcode das eben erstellte Script aufruft.<!--]--></p><!--[--><pre><code>actions:
  - trigger: ^unlock$
    lane: | 
      if [ &quot;$PASSCODE&quot; = &quot;123456789&quot; ]; then
        python3 ./scripts/fhem.py &quot;http://192.168.177.52:8083/fhem?cmd=set frontdoor on-for-timer 3&quot;
      fi
</code></pre><!--]--><p><!--[-->Das wars auch schon. Sobal nun der Passcode <code><!--[-->123456789<!--]--></code> eingegeben wird, wird via FHEM der GPIO Pin 17 für 3 Sekunden auf HIGH geschaltet, befindet sich am Pin ein Relais, so kann mit diesem die Haustür geöffnet werden. Jede andere Passcode Eingabe wird ignoriert.<!--]--></p></div><!--]--></div></div></div></div><script type="application/json" id="__NUXT_DATA__" data-ssr="true" data-src="/blog/fhem-als-tueroeffner/_payload.json">[{"state":1,"_errors":3,"serverRendered":6,"path":7,"prerenderedAt":8},["Reactive",2],{},["Reactive",4],{"content-query-b4YTKxhAjB":5},null,true,"/blog/fhem-als-tueroeffner",1692364067756]</script><script>window.__NUXT__={};window.__NUXT__.config={public:{content:{locales:[],defaultLocale:"",integrity:1692364054875,experimental:{stripQueryParameters:false,clientDB:false},api:{baseURL:"/api/_content"},navigation:{fields:[]},tags:{p:"prose-p",a:"prose-a",blockquote:"prose-blockquote","code-inline":"prose-code-inline",code:"prose-code",em:"prose-em",h1:"prose-h1",h2:"prose-h2",h3:"prose-h3",h4:"prose-h4",h5:"prose-h5",h6:"prose-h6",hr:"prose-hr",img:"prose-img",ul:"prose-ul",ol:"prose-ol",li:"prose-li",strong:"prose-strong",table:"prose-table",thead:"prose-thead",tbody:"prose-tbody",td:"prose-td",th:"prose-th",tr:"prose-tr"},highlight:false,wsUrl:"",documentDriven:false,host:"",trailingSlash:false,anchorLinks:{depth:4,exclude:[1]}}},app:{baseURL:"/",buildAssetsDir:"/_nuxt/",cdnURL:""}}</script><script type="module" src="/_nuxt/entry.798ec375.js" crossorigin></script></body>
</html>