[{"data":1,"prerenderedAt":511},["Reactive",2],{"content-query-b4YTKxhAjB":3},{"_path":4,"_dir":5,"_draft":6,"_partial":6,"_locale":7,"_empty":6,"title":8,"description":9,"lang":10,"created":11,"author":12,"tags":13,"body":19,"_type":506,"_id":507,"_source":508,"_file":509,"_extension":510},"/blog/fhem-als-tueroeffner","blog",false,"","FHEM als T√ºr√∂ffner","Wie man FHEM benutzt um mittels Passcode die Haust√ºr zu √∂ffnen","German üá©üá™","2023-08-18T00:00:00.000Z","Kai Mayer",[14,15,16,17,18],"fhem","raspberrypi","actions","smarthome","mqtt",{"type":20,"children":21,"toc":504},"root",[22,30,44,60,116,121,150,155,174,188,361,387,488,499],{"type":23,"tag":24,"props":25,"children":27},"element","h1",{"id":26},"fhem-als-t√ºr√∂ffner",[28],{"type":29,"value":8},"text",{"type":23,"tag":31,"props":32,"children":33},"p",{},[34,36,42],{"type":29,"value":35},"Der Core der Klingel bietet im wesentlichen eine Schnittstelle via MQTT an, √ºber diese verschiedene Events abgerufen oder ausgel√∂st werden k√∂nnen. Eine integration f√ºr weitere Schnittstellen gibt es nicht (bis auf einen mqtt-http-proxy). Das stellt uns jedoch kaum vor ein Problem, da es gen√ºgend Systeme mit MQTT integration gibt, die problemlos weitere Aufgaben f√ºr uns √ºbernehmen k√∂nnen. So werden wir im folgenden FHEM so konfigurieren, dass ein Pin des Raspberry Pi's beim eingeben von ",{"type":23,"tag":37,"props":38,"children":39},"code-inline",{},[40],{"type":29,"value":41},"123456789",{"type":29,"value":43}," als Passcode auf der Kiosk Anwendung des dieKlingel Software Packetes f√ºr drei Sekunden auf HIGH und danach wieder auf LOW geschaltet wird.",{"type":23,"tag":31,"props":45,"children":46},{},[47,49,58],{"type":29,"value":48},"Zu allererst werden wir in FHEM ein neues Ger√§t anlegen, welches den GPIO Pin 17 (",{"type":23,"tag":50,"props":51,"children":55},"a",{"href":52,"rel":53},"https://pinout.xyz/pinout/pin11_gpio17/",[54],"nofollow",[56],{"type":29,"value":57},"Pin 11",{"type":29,"value":59},") am Rasperry Pi f√ºr drei Sekunden auf HIGH und danach wieder auf LOW schaltet.",{"type":23,"tag":61,"props":62,"children":67},"code",{"className":63,"code":65,"language":66,"meta":7},[64],"language-bash","sudo addgroup fhem gpio\n","bash",[68],{"type":23,"tag":69,"props":70,"children":71},"pre",{},[72],{"type":23,"tag":61,"props":73,"children":74},{"__ignoreMap":7},[75],{"type":23,"tag":76,"props":77,"children":80},"span",{"class":78,"line":79},"line",1,[81,87,93,99,103,107,111],{"type":23,"tag":76,"props":82,"children":84},{"class":83},"ct-970031",[85],{"type":29,"value":86},"sudo",{"type":23,"tag":76,"props":88,"children":90},{"class":89},"ct-996399",[91],{"type":29,"value":92}," ",{"type":23,"tag":76,"props":94,"children":96},{"class":95},"ct-724922",[97],{"type":29,"value":98},"addgroup",{"type":23,"tag":76,"props":100,"children":101},{"class":89},[102],{"type":29,"value":92},{"type":23,"tag":76,"props":104,"children":105},{"class":95},[106],{"type":29,"value":14},{"type":23,"tag":76,"props":108,"children":109},{"class":89},[110],{"type":29,"value":92},{"type":23,"tag":76,"props":112,"children":113},{"class":95},[114],{"type":29,"value":115},"gpio",{"type":23,"tag":31,"props":117,"children":118},{},[119],{"type":29,"value":120},"In der Fhem Befehlszeile:",{"type":23,"tag":61,"props":122,"children":126},{"className":123,"code":125,"language":14,"meta":7},[124],"language-fhem","define frontdoor RPI_GPIO 17\nattr frontdoor direction output\n",[127],{"type":23,"tag":69,"props":128,"children":129},{},[130],{"type":23,"tag":61,"props":131,"children":132},{"__ignoreMap":7},[133,141],{"type":23,"tag":76,"props":134,"children":135},{"class":78,"line":79},[136],{"type":23,"tag":76,"props":137,"children":138},{},[139],{"type":29,"value":140},"define frontdoor RPI_GPIO 17\n",{"type":23,"tag":76,"props":142,"children":144},{"class":78,"line":143},2,[145],{"type":23,"tag":76,"props":146,"children":147},{},[148],{"type":29,"value":149},"attr frontdoor direction output",{"type":23,"tag":31,"props":151,"children":152},{},[153],{"type":29,"value":154},"So da wir nun den Pin als Ger√§t angelegt habe, k√∂nnen wir den Pin f√ºr drei Sekunden auf HIGH schalten",{"type":23,"tag":61,"props":156,"children":159},{"className":157,"code":158,"language":14,"meta":7},[124],"set frontdoor on-for-timer 3\n",[160],{"type":23,"tag":69,"props":161,"children":162},{},[163],{"type":23,"tag":61,"props":164,"children":165},{"__ignoreMap":7},[166],{"type":23,"tag":76,"props":167,"children":168},{"class":78,"line":79},[169],{"type":23,"tag":76,"props":170,"children":171},{},[172],{"type":29,"value":173},"set frontdoor on-for-timer 3",{"type":23,"tag":31,"props":175,"children":176},{},[177,179,186],{"type":29,"value":178},"Jetzt legen wir uns in der Konfiguration des Cores noch eine Lane an, welche per ",{"type":23,"tag":50,"props":180,"children":183},{"href":181,"rel":182},"https://wiki.fhem.de/wiki/CsrfToken-HowTo",[54],[184],{"type":29,"value":185},"HTTP den FHEM befehl",{"type":29,"value":187}," ausf√ºhrt und den Passcode √ºberpr√ºft. Um den FHEM Befehl auszuf√ºhren nehmen wir uns ein kurzes Python Script zu Hilfe",{"type":23,"tag":61,"props":189,"children":194},{"className":190,"code":192,"language":193,"meta":7},[191],"language-python","import os, json, requests, sys\n\nurl = sys.argv[1]\n\nresponse = requests.request(\"GET\", url)\ntoken = response.headers[\"X-FHEM-csrfToken\"]\nrequests.request(\"GET\", url + \"&XHR=1&fwcsrf=\" + token)\n","python",[195],{"type":23,"tag":69,"props":196,"children":197},{},[198],{"type":23,"tag":61,"props":199,"children":200},{"__ignoreMap":7},[201,215,223,253,261,289,316],{"type":23,"tag":76,"props":202,"children":203},{"class":78,"line":79},[204,210],{"type":23,"tag":76,"props":205,"children":207},{"class":206},"ct-748473",[208],{"type":29,"value":209},"import",{"type":23,"tag":76,"props":211,"children":212},{"class":89},[213],{"type":29,"value":214}," os, json, requests, sys\n",{"type":23,"tag":76,"props":216,"children":217},{"class":78,"line":143},[218],{"type":23,"tag":76,"props":219,"children":220},{},[221],{"type":29,"value":222},"\n",{"type":23,"tag":76,"props":224,"children":226},{"class":78,"line":225},3,[227,232,237,242,248],{"type":23,"tag":76,"props":228,"children":229},{"class":89},[230],{"type":29,"value":231},"url ",{"type":23,"tag":76,"props":233,"children":234},{"class":206},[235],{"type":29,"value":236},"=",{"type":23,"tag":76,"props":238,"children":239},{"class":89},[240],{"type":29,"value":241}," sys.argv[",{"type":23,"tag":76,"props":243,"children":245},{"class":244},"ct-531245",[246],{"type":29,"value":247},"1",{"type":23,"tag":76,"props":249,"children":250},{"class":89},[251],{"type":29,"value":252},"]\n",{"type":23,"tag":76,"props":254,"children":256},{"class":78,"line":255},4,[257],{"type":23,"tag":76,"props":258,"children":259},{},[260],{"type":29,"value":222},{"type":23,"tag":76,"props":262,"children":264},{"class":78,"line":263},5,[265,270,274,279,284],{"type":23,"tag":76,"props":266,"children":267},{"class":89},[268],{"type":29,"value":269},"response ",{"type":23,"tag":76,"props":271,"children":272},{"class":206},[273],{"type":29,"value":236},{"type":23,"tag":76,"props":275,"children":276},{"class":89},[277],{"type":29,"value":278}," requests.request(",{"type":23,"tag":76,"props":280,"children":281},{"class":95},[282],{"type":29,"value":283},"\"GET\"",{"type":23,"tag":76,"props":285,"children":286},{"class":89},[287],{"type":29,"value":288},", url)\n",{"type":23,"tag":76,"props":290,"children":292},{"class":78,"line":291},6,[293,298,302,307,312],{"type":23,"tag":76,"props":294,"children":295},{"class":89},[296],{"type":29,"value":297},"token ",{"type":23,"tag":76,"props":299,"children":300},{"class":206},[301],{"type":29,"value":236},{"type":23,"tag":76,"props":303,"children":304},{"class":89},[305],{"type":29,"value":306}," response.headers[",{"type":23,"tag":76,"props":308,"children":309},{"class":95},[310],{"type":29,"value":311},"\"X-FHEM-csrfToken\"",{"type":23,"tag":76,"props":313,"children":314},{"class":89},[315],{"type":29,"value":252},{"type":23,"tag":76,"props":317,"children":319},{"class":78,"line":318},7,[320,325,329,334,339,343,348,352,356],{"type":23,"tag":76,"props":321,"children":322},{"class":89},[323],{"type":29,"value":324},"requests.request(",{"type":23,"tag":76,"props":326,"children":327},{"class":95},[328],{"type":29,"value":283},{"type":23,"tag":76,"props":330,"children":331},{"class":89},[332],{"type":29,"value":333},", url ",{"type":23,"tag":76,"props":335,"children":336},{"class":206},[337],{"type":29,"value":338},"+",{"type":23,"tag":76,"props":340,"children":341},{"class":89},[342],{"type":29,"value":92},{"type":23,"tag":76,"props":344,"children":345},{"class":95},[346],{"type":29,"value":347},"\"&XHR=1&fwcsrf=\"",{"type":23,"tag":76,"props":349,"children":350},{"class":89},[351],{"type":29,"value":92},{"type":23,"tag":76,"props":353,"children":354},{"class":206},[355],{"type":29,"value":338},{"type":23,"tag":76,"props":357,"children":358},{"class":89},[359],{"type":29,"value":360}," token)",{"type":23,"tag":31,"props":362,"children":363},{},[364,366,371,373,378,380,385],{"type":29,"value":365},"Dieses legen wir im Ordner ",{"type":23,"tag":37,"props":367,"children":368},{},[369],{"type":29,"value":370},"scripts",{"type":29,"value":372}," im ",{"type":23,"tag":37,"props":374,"children":375},{},[376],{"type":29,"value":377},"$DIEKLINGEL_HOME",{"type":29,"value":379}," Verzeichnis ab. Wenn die Anwendung als Snap l√§uft befindet sich das Home Verzeichnis unter ",{"type":23,"tag":37,"props":381,"children":382},{},[383],{"type":29,"value":384},"/var/snap/dieklingel-core/current",{"type":29,"value":386},". Jetzt k√∂nne wir eine Lane erstellen, welches den Passcode √ºberpr√ºft und bei korrektem Passcode das eben erstellte Script aufruft.",{"type":23,"tag":61,"props":388,"children":393},{"className":389,"code":391,"language":392,"meta":7},[390],"language-yaml","actions:\n  - trigger: ^unlock$\n    lane: | \n      if [ \"$PASSCODE\" = \"123456789\" ]; then\n        python3 ./scripts/fhem.py \"http://192.168.177.52:8083/fhem?cmd=set frontdoor on-for-timer 3\"\n      fi\n","yaml",[394],{"type":23,"tag":69,"props":395,"children":396},{},[397],{"type":23,"tag":61,"props":398,"children":399},{"__ignoreMap":7},[400,413,436,464,472,480],{"type":23,"tag":76,"props":401,"children":402},{"class":78,"line":79},[403,408],{"type":23,"tag":76,"props":404,"children":406},{"class":405},"ct-802111",[407],{"type":29,"value":16},{"type":23,"tag":76,"props":409,"children":410},{"class":89},[411],{"type":29,"value":412},":\n",{"type":23,"tag":76,"props":414,"children":415},{"class":78,"line":143},[416,421,426,431],{"type":23,"tag":76,"props":417,"children":418},{"class":89},[419],{"type":29,"value":420},"  - ",{"type":23,"tag":76,"props":422,"children":423},{"class":405},[424],{"type":29,"value":425},"trigger",{"type":23,"tag":76,"props":427,"children":428},{"class":89},[429],{"type":29,"value":430},": ",{"type":23,"tag":76,"props":432,"children":433},{"class":95},[434],{"type":29,"value":435},"^unlock$\n",{"type":23,"tag":76,"props":437,"children":438},{"class":78,"line":225},[439,444,449,453,458],{"type":23,"tag":76,"props":440,"children":441},{"class":89},[442],{"type":29,"value":443},"    ",{"type":23,"tag":76,"props":445,"children":446},{"class":405},[447],{"type":29,"value":448},"lane",{"type":23,"tag":76,"props":450,"children":451},{"class":89},[452],{"type":29,"value":430},{"type":23,"tag":76,"props":454,"children":455},{"class":206},[456],{"type":29,"value":457},"|",{"type":23,"tag":76,"props":459,"children":461},{"class":460},"ct-935236",[462],{"type":29,"value":463}," \n",{"type":23,"tag":76,"props":465,"children":466},{"class":78,"line":255},[467],{"type":23,"tag":76,"props":468,"children":469},{"class":95},[470],{"type":29,"value":471},"      if [ \"$PASSCODE\" = \"123456789\" ]; then\n",{"type":23,"tag":76,"props":473,"children":474},{"class":78,"line":263},[475],{"type":23,"tag":76,"props":476,"children":477},{"class":95},[478],{"type":29,"value":479},"        python3 ./scripts/fhem.py \"http://192.168.177.52:8083/fhem?cmd=set frontdoor on-for-timer 3\"\n",{"type":23,"tag":76,"props":481,"children":482},{"class":78,"line":291},[483],{"type":23,"tag":76,"props":484,"children":485},{"class":95},[486],{"type":29,"value":487},"      fi",{"type":23,"tag":31,"props":489,"children":490},{},[491,493,497],{"type":29,"value":492},"Das wars auch schon. Sobal nun der Passcode ",{"type":23,"tag":37,"props":494,"children":495},{},[496],{"type":29,"value":41},{"type":29,"value":498}," eingegeben wird, wird via FHEM der GPIO Pin 17 f√ºr 3 Sekunden auf HIGH geschaltet, befindet sich am Pin ein Relais, so kann mit diesem die Haust√ºr ge√∂ffnet werden. Jede andere Passcode Eingabe wird ignoriert.",{"type":23,"tag":500,"children":501},"style",[502],{"type":29,"value":503},".ct-970031{color:#6F42C1;}\n.ct-996399{color:#24292E;}\n.ct-724922{color:#032F62;}\n.ct-748473{color:#D73A49;}\n.ct-531245{color:#005CC5;}\n.ct-802111{color:#22863A;}\n.ct-935236{color:#B31D28;font-style:italic;}",{"title":7,"searchDepth":143,"depth":143,"links":505},[],"markdown","content:blog:fhem-als-tueroeffner.md","content","blog/fhem-als-tueroeffner.md","md",1707988147735]