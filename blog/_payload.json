[{"data":1,"prerenderedAt":536},["Reactive",2],{"content-query-AYsYKEZnkk":3},[4,41],{"_path":5,"_dir":6,"_draft":7,"_partial":7,"_locale":8,"_empty":7,"title":9,"description":10,"lang":11,"author":12,"tags":13,"body":17,"_type":36,"_id":37,"_source":38,"_file":39,"_extension":40},"/blog/doorunit-design-v2","blog",false,"","doorunit-design-v2","How we redesinged the whole doorunit, based on experience from version 1","English üá¨üáß","Kai Mayer",[14,15,16],"CAD","design","hardware",{"type":18,"children":19,"toc":33},"root",[20,27],{"type":21,"tag":22,"props":23,"children":24},"element","h1",{"id":9},[25],{"type":26,"value":9},"text",{"type":21,"tag":28,"props":29,"children":30},"p",{},[31],{"type":26,"value":32},"Hey, this articel isn't finished yet, come back in few days...",{"title":8,"searchDepth":34,"depth":34,"links":35},2,[],"markdown","content:blog:doorunit-design-v2.md","content","blog/doorunit-design-v2.md","md",{"_path":42,"_dir":6,"_draft":7,"_partial":7,"_locale":8,"_empty":7,"title":43,"description":44,"lang":45,"created":46,"author":12,"tags":47,"body":53,"_type":36,"_id":534,"_source":38,"_file":535,"_extension":40},"/blog/fhem-als-tueroeffner","FHEM als T√ºr√∂ffner","Wie man FHEM benutzt um mittels Passcode die Haust√ºr zu √∂ffnen","German üá©üá™","2023-08-18T00:00:00.000Z",[48,49,50,51,52],"fhem","raspberrypi","actions","smarthome","mqtt",{"type":18,"children":54,"toc":532},[55,60,73,89,145,150,178,183,202,216,389,415,516,527],{"type":21,"tag":22,"props":56,"children":58},{"id":57},"fhem-als-t√ºr√∂ffner",[59],{"type":26,"value":43},{"type":21,"tag":28,"props":61,"children":62},{},[63,65,71],{"type":26,"value":64},"Der Core der Klingel bietet im wesentlichen eine Schnittstelle via MQTT an, √ºber diese verschiedene Events abgerufen oder ausgel√∂st werden k√∂nnen. Eine integration f√ºr weitere Schnittstellen gibt es nicht (bis auf einen mqtt-http-proxy). Das stellt uns jedoch kaum vor ein Problem, da es gen√ºgend Systeme mit MQTT integration gibt, die problemlos weitere Aufgaben f√ºr uns √ºbernehmen k√∂nnen. So werden wir im folgenden FHEM so konfigurieren, dass ein Pin des Raspberry Pi's beim eingeben von ",{"type":21,"tag":66,"props":67,"children":68},"code-inline",{},[69],{"type":26,"value":70},"123456789",{"type":26,"value":72}," als Passcode auf der Kiosk Anwendung des dieKlingel Software Packetes f√ºr drei Sekunden auf HIGH und danach wieder auf LOW geschaltet wird.",{"type":21,"tag":28,"props":74,"children":75},{},[76,78,87],{"type":26,"value":77},"Zu allererst werden wir in FHEM ein neues Ger√§t anlegen, welches den GPIO Pin 17 (",{"type":21,"tag":79,"props":80,"children":84},"a",{"href":81,"rel":82},"https://pinout.xyz/pinout/pin11_gpio17/",[83],"nofollow",[85],{"type":26,"value":86},"Pin 11",{"type":26,"value":88},") am Rasperry Pi f√ºr drei Sekunden auf HIGH und danach wieder auf LOW schaltet.",{"type":21,"tag":90,"props":91,"children":96},"code",{"className":92,"code":94,"language":95,"meta":8},[93],"language-bash","sudo addgroup fhem gpio\n","bash",[97],{"type":21,"tag":98,"props":99,"children":100},"pre",{},[101],{"type":21,"tag":90,"props":102,"children":103},{"__ignoreMap":8},[104],{"type":21,"tag":105,"props":106,"children":109},"span",{"class":107,"line":108},"line",1,[110,116,122,128,132,136,140],{"type":21,"tag":105,"props":111,"children":113},{"class":112},"ct-970031",[114],{"type":26,"value":115},"sudo",{"type":21,"tag":105,"props":117,"children":119},{"class":118},"ct-996399",[120],{"type":26,"value":121}," ",{"type":21,"tag":105,"props":123,"children":125},{"class":124},"ct-724922",[126],{"type":26,"value":127},"addgroup",{"type":21,"tag":105,"props":129,"children":130},{"class":118},[131],{"type":26,"value":121},{"type":21,"tag":105,"props":133,"children":134},{"class":124},[135],{"type":26,"value":48},{"type":21,"tag":105,"props":137,"children":138},{"class":118},[139],{"type":26,"value":121},{"type":21,"tag":105,"props":141,"children":142},{"class":124},[143],{"type":26,"value":144},"gpio",{"type":21,"tag":28,"props":146,"children":147},{},[148],{"type":26,"value":149},"In der Fhem Befehlszeile:",{"type":21,"tag":90,"props":151,"children":155},{"className":152,"code":154,"language":48,"meta":8},[153],"language-fhem","define frontdoor RPI_GPIO 17\nattr frontdoor direction output\n",[156],{"type":21,"tag":98,"props":157,"children":158},{},[159],{"type":21,"tag":90,"props":160,"children":161},{"__ignoreMap":8},[162,170],{"type":21,"tag":105,"props":163,"children":164},{"class":107,"line":108},[165],{"type":21,"tag":105,"props":166,"children":167},{},[168],{"type":26,"value":169},"define frontdoor RPI_GPIO 17\n",{"type":21,"tag":105,"props":171,"children":172},{"class":107,"line":34},[173],{"type":21,"tag":105,"props":174,"children":175},{},[176],{"type":26,"value":177},"attr frontdoor direction output",{"type":21,"tag":28,"props":179,"children":180},{},[181],{"type":26,"value":182},"So da wir nun den Pin als Ger√§t angelegt habe, k√∂nnen wir den Pin f√ºr drei Sekunden auf HIGH schalten",{"type":21,"tag":90,"props":184,"children":187},{"className":185,"code":186,"language":48,"meta":8},[153],"set frontdoor on-for-timer 3\n",[188],{"type":21,"tag":98,"props":189,"children":190},{},[191],{"type":21,"tag":90,"props":192,"children":193},{"__ignoreMap":8},[194],{"type":21,"tag":105,"props":195,"children":196},{"class":107,"line":108},[197],{"type":21,"tag":105,"props":198,"children":199},{},[200],{"type":26,"value":201},"set frontdoor on-for-timer 3",{"type":21,"tag":28,"props":203,"children":204},{},[205,207,214],{"type":26,"value":206},"Jetzt legen wir uns in der Konfiguration des Cores noch eine Lane an, welche per ",{"type":21,"tag":79,"props":208,"children":211},{"href":209,"rel":210},"https://wiki.fhem.de/wiki/CsrfToken-HowTo",[83],[212],{"type":26,"value":213},"HTTP den FHEM befehl",{"type":26,"value":215}," ausf√ºhrt und den Passcode √ºberpr√ºft. Um den FHEM Befehl auszuf√ºhren nehmen wir uns ein kurzes Python Script zu Hilfe",{"type":21,"tag":90,"props":217,"children":222},{"className":218,"code":220,"language":221,"meta":8},[219],"language-python","import os, json, requests, sys\n\nurl = sys.argv[1]\n\nresponse = requests.request(\"GET\", url)\ntoken = response.headers[\"X-FHEM-csrfToken\"]\nrequests.request(\"GET\", url + \"&XHR=1&fwcsrf=\" + token)\n","python",[223],{"type":21,"tag":98,"props":224,"children":225},{},[226],{"type":21,"tag":90,"props":227,"children":228},{"__ignoreMap":8},[229,243,251,281,289,317,344],{"type":21,"tag":105,"props":230,"children":231},{"class":107,"line":108},[232,238],{"type":21,"tag":105,"props":233,"children":235},{"class":234},"ct-748473",[236],{"type":26,"value":237},"import",{"type":21,"tag":105,"props":239,"children":240},{"class":118},[241],{"type":26,"value":242}," os, json, requests, sys\n",{"type":21,"tag":105,"props":244,"children":245},{"class":107,"line":34},[246],{"type":21,"tag":105,"props":247,"children":248},{},[249],{"type":26,"value":250},"\n",{"type":21,"tag":105,"props":252,"children":254},{"class":107,"line":253},3,[255,260,265,270,276],{"type":21,"tag":105,"props":256,"children":257},{"class":118},[258],{"type":26,"value":259},"url ",{"type":21,"tag":105,"props":261,"children":262},{"class":234},[263],{"type":26,"value":264},"=",{"type":21,"tag":105,"props":266,"children":267},{"class":118},[268],{"type":26,"value":269}," sys.argv[",{"type":21,"tag":105,"props":271,"children":273},{"class":272},"ct-531245",[274],{"type":26,"value":275},"1",{"type":21,"tag":105,"props":277,"children":278},{"class":118},[279],{"type":26,"value":280},"]\n",{"type":21,"tag":105,"props":282,"children":284},{"class":107,"line":283},4,[285],{"type":21,"tag":105,"props":286,"children":287},{},[288],{"type":26,"value":250},{"type":21,"tag":105,"props":290,"children":292},{"class":107,"line":291},5,[293,298,302,307,312],{"type":21,"tag":105,"props":294,"children":295},{"class":118},[296],{"type":26,"value":297},"response ",{"type":21,"tag":105,"props":299,"children":300},{"class":234},[301],{"type":26,"value":264},{"type":21,"tag":105,"props":303,"children":304},{"class":118},[305],{"type":26,"value":306}," requests.request(",{"type":21,"tag":105,"props":308,"children":309},{"class":124},[310],{"type":26,"value":311},"\"GET\"",{"type":21,"tag":105,"props":313,"children":314},{"class":118},[315],{"type":26,"value":316},", url)\n",{"type":21,"tag":105,"props":318,"children":320},{"class":107,"line":319},6,[321,326,330,335,340],{"type":21,"tag":105,"props":322,"children":323},{"class":118},[324],{"type":26,"value":325},"token ",{"type":21,"tag":105,"props":327,"children":328},{"class":234},[329],{"type":26,"value":264},{"type":21,"tag":105,"props":331,"children":332},{"class":118},[333],{"type":26,"value":334}," response.headers[",{"type":21,"tag":105,"props":336,"children":337},{"class":124},[338],{"type":26,"value":339},"\"X-FHEM-csrfToken\"",{"type":21,"tag":105,"props":341,"children":342},{"class":118},[343],{"type":26,"value":280},{"type":21,"tag":105,"props":345,"children":347},{"class":107,"line":346},7,[348,353,357,362,367,371,376,380,384],{"type":21,"tag":105,"props":349,"children":350},{"class":118},[351],{"type":26,"value":352},"requests.request(",{"type":21,"tag":105,"props":354,"children":355},{"class":124},[356],{"type":26,"value":311},{"type":21,"tag":105,"props":358,"children":359},{"class":118},[360],{"type":26,"value":361},", url ",{"type":21,"tag":105,"props":363,"children":364},{"class":234},[365],{"type":26,"value":366},"+",{"type":21,"tag":105,"props":368,"children":369},{"class":118},[370],{"type":26,"value":121},{"type":21,"tag":105,"props":372,"children":373},{"class":124},[374],{"type":26,"value":375},"\"&XHR=1&fwcsrf=\"",{"type":21,"tag":105,"props":377,"children":378},{"class":118},[379],{"type":26,"value":121},{"type":21,"tag":105,"props":381,"children":382},{"class":234},[383],{"type":26,"value":366},{"type":21,"tag":105,"props":385,"children":386},{"class":118},[387],{"type":26,"value":388}," token)",{"type":21,"tag":28,"props":390,"children":391},{},[392,394,399,401,406,408,413],{"type":26,"value":393},"Dieses legen wir im Ordner ",{"type":21,"tag":66,"props":395,"children":396},{},[397],{"type":26,"value":398},"scripts",{"type":26,"value":400}," im ",{"type":21,"tag":66,"props":402,"children":403},{},[404],{"type":26,"value":405},"$DIEKLINGEL_HOME",{"type":26,"value":407}," Verzeichnis ab. Wenn die Anwendung als Snap l√§uft befindet sich das Home Verzeichnis unter ",{"type":21,"tag":66,"props":409,"children":410},{},[411],{"type":26,"value":412},"/var/snap/dieklingel-core/current",{"type":26,"value":414},". Jetzt k√∂nne wir eine Lane erstellen, welches den Passcode √ºberpr√ºft und bei korrektem Passcode das eben erstellte Script aufruft.",{"type":21,"tag":90,"props":416,"children":421},{"className":417,"code":419,"language":420,"meta":8},[418],"language-yaml","actions:\n  - trigger: ^unlock$\n    lane: | \n      if [ \"$PASSCODE\" = \"123456789\" ]; then\n        python3 ./scripts/fhem.py \"http://192.168.177.52:8083/fhem?cmd=set frontdoor on-for-timer 3\"\n      fi\n","yaml",[422],{"type":21,"tag":98,"props":423,"children":424},{},[425],{"type":21,"tag":90,"props":426,"children":427},{"__ignoreMap":8},[428,441,464,492,500,508],{"type":21,"tag":105,"props":429,"children":430},{"class":107,"line":108},[431,436],{"type":21,"tag":105,"props":432,"children":434},{"class":433},"ct-802111",[435],{"type":26,"value":50},{"type":21,"tag":105,"props":437,"children":438},{"class":118},[439],{"type":26,"value":440},":\n",{"type":21,"tag":105,"props":442,"children":443},{"class":107,"line":34},[444,449,454,459],{"type":21,"tag":105,"props":445,"children":446},{"class":118},[447],{"type":26,"value":448},"  - ",{"type":21,"tag":105,"props":450,"children":451},{"class":433},[452],{"type":26,"value":453},"trigger",{"type":21,"tag":105,"props":455,"children":456},{"class":118},[457],{"type":26,"value":458},": ",{"type":21,"tag":105,"props":460,"children":461},{"class":124},[462],{"type":26,"value":463},"^unlock$\n",{"type":21,"tag":105,"props":465,"children":466},{"class":107,"line":253},[467,472,477,481,486],{"type":21,"tag":105,"props":468,"children":469},{"class":118},[470],{"type":26,"value":471},"    ",{"type":21,"tag":105,"props":473,"children":474},{"class":433},[475],{"type":26,"value":476},"lane",{"type":21,"tag":105,"props":478,"children":479},{"class":118},[480],{"type":26,"value":458},{"type":21,"tag":105,"props":482,"children":483},{"class":234},[484],{"type":26,"value":485},"|",{"type":21,"tag":105,"props":487,"children":489},{"class":488},"ct-935236",[490],{"type":26,"value":491}," \n",{"type":21,"tag":105,"props":493,"children":494},{"class":107,"line":283},[495],{"type":21,"tag":105,"props":496,"children":497},{"class":124},[498],{"type":26,"value":499},"      if [ \"$PASSCODE\" = \"123456789\" ]; then\n",{"type":21,"tag":105,"props":501,"children":502},{"class":107,"line":291},[503],{"type":21,"tag":105,"props":504,"children":505},{"class":124},[506],{"type":26,"value":507},"        python3 ./scripts/fhem.py \"http://192.168.177.52:8083/fhem?cmd=set frontdoor on-for-timer 3\"\n",{"type":21,"tag":105,"props":509,"children":510},{"class":107,"line":319},[511],{"type":21,"tag":105,"props":512,"children":513},{"class":124},[514],{"type":26,"value":515},"      fi",{"type":21,"tag":28,"props":517,"children":518},{},[519,521,525],{"type":26,"value":520},"Das wars auch schon. Sobal nun der Passcode ",{"type":21,"tag":66,"props":522,"children":523},{},[524],{"type":26,"value":70},{"type":26,"value":526}," eingegeben wird, wird via FHEM der GPIO Pin 17 f√ºr 3 Sekunden auf HIGH geschaltet, befindet sich am Pin ein Relais, so kann mit diesem die Haust√ºr ge√∂ffnet werden. Jede andere Passcode Eingabe wird ignoriert.",{"type":21,"tag":528,"children":529},"style",[530],{"type":26,"value":531},".ct-970031{color:#6F42C1;}\n.ct-996399{color:#24292E;}\n.ct-724922{color:#032F62;}\n.ct-748473{color:#D73A49;}\n.ct-531245{color:#005CC5;}\n.ct-802111{color:#22863A;}\n.ct-935236{color:#B31D28;font-style:italic;}",{"title":8,"searchDepth":34,"depth":34,"links":533},[],"content:blog:fhem-als-tueroeffner.md","blog/fhem-als-tueroeffner.md",1707989712725]